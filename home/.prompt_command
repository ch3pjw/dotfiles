#!/bin/bash
source .bash_colors

function git_prompt {
    local output
    if git branch &> /dev/null; then
        # git is working and we're on a git branch
        if echo `git status` | grep "nothing to commit" > /dev/null 2>&1; then
            # Clean repository - nothing to commit
            output="${Green}$(__git_ps1 "(%s)")${Color_Off} "
        elif echo `git status` | grep "nothing added to commit but untracked files present" > /dev/null 2>&1; then
            # No changes but files to add
            output="${Cyan}$(__git_ps1 "[%s]")${Color_Off} "
        else
            # Changes to working tree
            output="${Red}$(__git_ps1 "{%s}")${Color_Off} "
        fi
    else
        # prompt component when not in git
        output=''
    fi
    echo -n ${output}
}

function prompt_command {
    local exit_status=$? # Must be the first thing we do
    if [[ $exit_status == 0 ]]; then
        local exit_status_text=${BGreen}✓${Color_Off}
    else
        local exit_status_text=${BRed}✗${Color_Off}
    fi

    local hostname=$HOSTNAME
    local username=$(whoami)
    local pwd=$(pwd | sed "s|$HOME|~|")

    PS1="${exit_status_text}${BGreen}${username}@${hostname} ${BBlue}${pwd} $(git_prompt)${BBlue}♮ ${Color_Off}"
}
